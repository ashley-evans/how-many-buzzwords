{
    "StartAt": "Parse and find keyphrases for each URL",
    "States": {
        "Parse and find keyphrases for each URL": {
            "Type": "Map",
            "ItemsPath": "$.pathnames",
            "MaxConcurrency": 20,
            "ResultPath": "$.keyphrases",
            "Parameters": {
                "baseURL.$": "$.baseURL",
                "pathname.$": "$$.Map.Item.Value"
            },
            "Iterator": {
                "StartAt": "Parse URL",
                "States": {
                    "Parse URL": {
                        "Type": "Task",
                        "Resource": "${ScrapeURLARN}",
                        "Retry": [
                            {
                                "ErrorEquals": [
                                    "Lambda.ServiceException",
                                    "Lambda.AWSLambdaException",
                                    "Lambda.SdkClientException",
                                    "Lambda.TooManyRequestsException",
                                    "Lambda.Unknown"
                                ],
                                "IntervalSeconds": 3,
                                "BackoffRate": 2.0,
                                "MaxAttempts": 3
                            }
                        ],
                        "Next": "Find Keyphrases",
                        "ResultPath": null
                    },
                    "Find Keyphrases": {
                        "Type": "Task",
                        "Resource": "${FindKeyphrasesARN}",
                        "Retry": [
                            {
                                "ErrorEquals": [
                                    "Lambda.ServiceException",
                                    "Lambda.AWSLambdaException",
                                    "Lambda.SdkClientException",
                                    "Lambda.TooManyRequestsException",
                                    "Lambda.Unknown"
                                ],
                                "IntervalSeconds": 3,
                                "BackoffRate": 2.0,
                                "MaxAttempts": 3
                            }
                        ],
                        "End": true
                    }
                }
            },
            "End": true
        }
    }
}
